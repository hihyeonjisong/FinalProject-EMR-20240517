<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.ISurgeryReservationMapper">
		<select id="getSurgeryReservWaitingList" resultType="surgeryReservationVO">
		SELECT 
		      SR.SURGERY_RESERVATION_NO
		    , SR.SURGERY_RESERVATION_DATE
		    , SR.SURGERY_RESERVATION_TIME
		    , SR.SURGERY_ROOM_NO
		    , SR.ORDER_NO
		    , SR.PATNT_NO
		    , SR.SURGERY_DOCTOR
		    , SR.SURGERY_KIND_CODE
		    , SR.SURGERY_RESERVATION_STATUS
		    , E.EMP_NO
		    , MD.MEM_NAME AS doctorName
		    , M.MEM_NAME as patntName
		    , M.MEM_AGE 
		    , M.MEM_GENDER
		    , M.MEM_TEL
		    , CC.CODE_NAME as clinicName
		    , SK.SURGERY_KIND_NAME
		    , BC.CODE_NAME as bodycodeName
		    , HC.CODE_NAME as historyName

		FROM
		    SURGERY_RESERVATION SR
		INNER JOIN
		    EMP E ON E.EMP_NO = SR.SURGERY_DOCTOR
		INNER JOIN
		    MEMBER MD ON MD.MEM_NO = E.MEM_NO
		INNER JOIN
		    PATIENT P ON P.PATNT_NO = SR.PATNT_NO
		INNER JOIN
		    MEMBER M ON M.MEM_NO = P.MEM_NO
		INNER JOIN
		    "ORDER" O ON O.ORDER_NO = SR.ORDER_NO
		INNER JOIN
		    CHART C ON C.CHART_NO = O.CHART_NO
		INNER JOIN
		    RECEIPT R ON R.RECEIPT_NO = C.RECEIPT_NO
		INNER JOIN
		    COMMON_CODE CC ON CC.CODE_NO = R.CLINIC_NO
		INNER JOIN
		    SURGERY_KIND SK ON SK.SURGERY_KIND_CODE = SR.SURGERY_KIND_CODE
		INNER JOIN
		    COMMON_CODE BC ON BC.CODE_NO = O.BODY_CODE
		INNER JOIN
		    HISTORY H ON H.RECEIPT_NO = R.RECEIPT_NO
		INNER JOIN
		    COMMON_CODE HC ON HC.CODE_NO = H.HISTORY_STATUS

		WHERE
		    SR.SURGERY_RESERVATION_STATUS = 'N'
	</select>
	
	<select id="getSurgeryCal" resultType="surgeryReservationVO">
		SELECT 
		      SR.SURGERY_RESERVATION_NO
		    , SR.SURGERY_RESERVATION_DATE as "start"
		    , SR.SURGERY_RESERVATION_TIME
		    , SR.SURGERY_ROOM_NO
		    , SR.ORDER_NO
		    , SR.PATNT_NO
		    , SR.SURGERY_DOCTOR
		    , SR.SURGERY_KIND_CODE
		    , SR.SURGERY_RESERVATION_STATUS
		    , E.EMP_NO
		    , M.MEM_AGE
    		, M.MEM_GENDER
    		, M.MEM_TEL
		    , MD.MEM_NAME as doctorName
		    , M.MEM_NAME as title
		    , CC.CODE_NAME as clinicName
		    , SK.SURGERY_KIND_NAME
		    , BC.CODE_NAME as bodycodeName

		    , PT.PROTECTOR_NO
		    , PT.PROTECTOR_NAME
		    , PT.PROTECTOR_RELATE
		    , PT.PROTECTOR_TEL
		FROM
		    SURGERY_RESERVATION SR
		INNER JOIN
		    EMP E ON E.EMP_NO = SR.SURGERY_DOCTOR
		INNER JOIN
		    MEMBER MD ON MD.MEM_NO = E.MEM_NO
		INNER JOIN
			PATIENT P ON P.PATNT_NO = SR.PATNT_NO
		INNER JOIN
		    MEMBER M ON M.MEM_NO = P.MEM_NO
		INNER JOIN
		    "ORDER" O ON O.ORDER_NO = SR.ORDER_NO
		INNER JOIN
		    CHART C ON C.CHART_NO = O.CHART_NO
		INNER JOIN
		    RECEIPT R ON R.RECEIPT_NO = C.RECEIPT_NO
		INNER JOIN
		    COMMON_CODE CC ON CC.CODE_NO = R.CLINIC_NO
		INNER JOIN
		    SURGERY_KIND SK ON SK.SURGERY_KIND_CODE = SR.SURGERY_KIND_CODE
		INNER JOIN
		    COMMON_CODE BC ON BC.CODE_NO = O.BODY_CODE
		LEFT JOIN
			PROTECTOR PT ON PT.PATNT_NO = SR.PATNT_NO
		WHERE
		    SR.SURGERY_RESERVATION_STATUS = 'Y'
	</select>
	
	<select id="surgeryDateCheck" resultType="surgeryReservationVO">
		SELECT
		    *
		FROM
		    SURGERY_RESERVATION
		WHERE
		    SURGERY_RESERVATION_STATUS = 'Y'
		AND
		    TRUNC(SURGERY_RESERVATION_DATE) = #{startStr}
	</select>
	
	<update id="surgeryReservation">
		UPDATE
			SURGERY_RESERVATION
		SET
			  SURGERY_RESERVATION_DATE = #{surgeryReservationDate}
			, SURGERY_RESERVATION_TIME = #{surgeryReservationTime}
			, SURGERY_ROOM_NO = #{surgeryRoomNo}
			, SURGERY_RESERVATION_STATUS = 'Y'
		WHERE
			SURGERY_RESERVATION_NO = #{surgeryReservationNo}
	</update>
	
	<update id="surgeryModify">
		UPDATE
			SURGERY_RESERVATION
		SET
			SURGERY_RESERVATION_DATE = #{surgeryReservationDate}
			, SURGERY_RESERVATION_TIME = #{surgeryReservationTime}
			, SURGERY_ROOM_NO = #{surgeryRoomNo}
		WHERE
			SURGERY_RESERVATION_NO = #{surgeryReservationNo}	
	</update>
	
	<delete id="surgeryDelete">
		DELETE
			SURGERY_RESERVATION
		WHERE
			SURGERY_RESERVATION_NO = #{surgeryReservationNo}
			
	</delete>
	
</mapper>